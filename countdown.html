<!DOCTYPE HTML>
<html>
<meta charset="utf-8">

<style>
	body {
		text-align: center;
		font-size: 60px;
		font-family: monospace;
	}
	#syntax {
		font-size: 20px;
	}
</style>

<body>
<div id="title"></div>
<div id="timer"></div>
<div id="syntax"></div>

<script>
//Parse the (optional) page title, countdown target time, and optionally completion text
//Page argument format should be filename.html?date=YYYY-MM-DDTHH:MM:SS&title=foo&finish=bar
//For instance a countdown to 1 February 2034 at 5:30 p.m., with title text "How long until the thing happens?" and the timer reading "Now!" when it reaches 0
//should have a query string ?date=2034-02-01T17:30:00&title=How long until the thing happens?&finish=Now!
//Note that since a URL cannot end with a question mark you may have to add an extra dummy variable at the end in some cases; for instance use
//?date=2034-02-01T17:30:00&title=How long until the thing happens?& to produce the above without finish text.
//If date is not populated a one minute timer is the default. If title is not populated then title is hidden by default.

//helper function to parse URL query string
function getQueryVariable(variable)
{
       var query = window.location.search.substring(1);
       var vars = query.split("&");
       for (var i=0;i<vars.length;i++) {
               var pair = vars[i].split("=");
               if(pair[0] == variable){return pair[1];}
       }
       return(false);
}

// Set the countdown target time. For the purposes of this script I am assuming the person entering the URL is entering a UTC time.
// This way the countdown works the same for users anywhere; i.e. a user in one location can send the page to a user in a different timezone,
// and the countdown should run out at the same absolute time for both of them.
var targetDate = new Date(getQueryVariable("date"));
//if no valid date was supplied, set target date to one minute in the future.
if (isNaN(targetDate)) {
	targetDate = new Date().getTime() + 60000;
	console.log(targetDate);
} else {
	//Otherwise offset the target time (in UTC) to get a target time in the client's time zone.
	targetDate = new Date(targetDate - targetDate.getTimezoneOffset()*60*1000).getTime(); 
}

// Set the page title. innerText is used instead of innerHTML because since elements are populated using the URL contents there is a significant risk of content injection.
var titleText = decodeURI(getQueryVariable("title"));
console.log(getQueryVariable("title"))
//if no title was supplied, make title blank
if (getQueryVariable("title") == false) {
	titleText = "";
}
document.title = titleText;
document.getElementById("title").innerText = titleText;

// Set the finish text. If finish text is not supplied (is false), timer simply stops at 0.
var finishText = decodeURI(getQueryVariable("finish"));
if (getQueryVariable("finish") == false) {
	finishText = "00:00:00.00";
}
console.log(getQueryVariable("finish"))

// Update every 30ms (roughly 30fps)
var x = setInterval(function() {

	// Get today's date and time.
	var now = new Date().getTime();
  
	// Find the distance between now and the count down date
	var distance = targetDate - now;
    
	// calculations for hours, minutes, seconds
	var hours = Math.floor(distance/(1000 * 60 * 60));
	var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
	var seconds = ((distance % (1000 * 60)) / 1000);
    
	// Output the result in timer div
	document.getElementById("timer").innerText = hours.toString().padStart(2, "0") + ":"
  + minutes.toString().padStart(2, 0) + ":" + seconds.toFixed(2).toString().padStart(5, 0);
    
	// If the count down is over, write some text 
	if (distance < 0) {
		clearInterval(x);
		document.getElementById("timer").innerText = finishText;
  }
}, 30);

</script>

</body>
</html>
